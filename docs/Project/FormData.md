# FormData

## 1.å…³äºä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« 

åœ¨å¸¸è§çš„åå°é¡¹ç›®å¼€å‘ä¸­ï¼Œä¼šæœ‰éå¸¸å¤šçš„è¡¨å•æäº¤ç›¸å…³çš„å†…å®¹ï¼Œæ¶‰åŠåˆ°è¡¨å•ï¼Œå°±ä¼šæœ‰è¡¨å•çš„æ ¡éªŒï¼Œå›¾ç‰‡ä¸Šä¼ ï¼Œé™„ä»¶ä¸Šä¼ ç­‰ç­‰ã€‚

### é¦–å…ˆè¯´æ ¡éªŒ

1. è¡¨å•çš„æ ¡éªŒå¯è°“æ˜¯åƒå¥‡ç™¾æ€ªï¼Œè¾“å…¥æ¡†çš„éç©ºæ ¡éªŒï¼Œå›¾ç‰‡é™„ä»¶å¤§å°æ ¼å¼æ ¡éªŒï¼Œè¿™äº›éƒ½æ˜¯ä¸€ç§å¸¸è§çš„æ ¡éªŒï¼Œæ— è®ºæ˜¯ ElementUI[https://element.eleme.cn/#/zh-CN]ï¼Œ
   è¿˜æ˜¯ Antd éƒ½ä¼šæœ‰è‡ªå·±çš„è¡¨å•æ ¡éªŒæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å®˜ç½‘å‚è€ƒå®ä¾‹å†™å°±å¯ä»¥äº†ã€‚

2. å¦å¤–åœ¨æ ¡éªŒçš„è¿‡ç¨‹ä¸­ï¼Œéš¾å…ä¼šç¢°åˆ°ä¸€äº›æ¯”è¾ƒç¹ççš„ä¾‹å¦‚æ‰‹æœºå·ç ï¼Œèº«ä»½è¯ç­‰æ•æ„Ÿä¸”éå¸¸è§„éœ€è¦ä½¿ç”¨æ­£åˆ™
   è¡¨è¾¾å¼è¿›è¡Œæ•°æ®æ ¡éªŒçš„æ—¶å€™ï¼Œåœ¨è¿™é‡Œæ¨èä½¿ç”¨çš„ä¸€ä¸ª VSCode çš„å°æ’ä»¶ any-roleï¼Œ åªéœ€è¦åœ¨æ ¡éªŒçš„
   åœ°æ–¹æ‰“å‡º @zz å°±ä¼šæœ‰ä¸€å¤§ä¸²æ­£åˆ™æ ¡éªŒè§„åˆ™ä¾›å¤§å®¶ä½¿ç”¨

ä»¥ä¸Šå°±æ˜¯ä¸€äº›å…³äºè¡¨å•æ ¡éªŒä¸œè¥¿äº†

## 2. new FormData() å¯¹è±¡

ç›¸ä¿¡ä½ çœ‹åˆ° new FormData() è¿™ä¸ªå®ä¾‹å¯¹è±¡çš„æ—¶å€™ä¼šæƒ³ï¼Œè¿™æ˜¯ä»€ä¹ˆï¼Œéƒ½æ²¡è§è¿‡ï¼ŒOKï¼Œfineã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ MDN å®˜æ–¹æ˜¯æ€ä¹ˆå®šä¹‰å®ƒçš„ï¼Œå®ƒåˆæ˜¯åšä»€ä¹ˆçš„!

ä»¥ä¸‹å°±æ˜¯ MDN çš„å®˜æ–¹è§£é‡Šï¼Œæˆ‘å¯¹å…¶å†…åšäº†ç²¾ç®€ï¼Œå¦‚æœå¸Œæœ›æ·±å…¥äº†è§£ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡è¿™é‡Œï¼Œç›´æ¥æŸ¥çœ‹
å®˜æ–¹æ–‡æ¡£ï¼

FormData å¯¹è±¡ç”¨ä»¥å°†æ•°æ®ç¼–è¯‘æˆé”®å€¼å¯¹å‘åç«¯å‘é€æ•°æ®ï¼Œå…¶ä¸»è¦ç”¨äºå‘é€è¡¨å•æ•°æ®ï¼Œä¹Ÿå¯ä»¥
ç‹¬ç«‹äºè¡¨å•ä½¿ç”¨ï¼Œå‘åç«¯å‘é€å¸¦é”®æ•°æ®ã€‚

å¦‚æœè¡¨å• enctypt å±æ€§æ˜¯ multipart/form-dataï¼Œåˆ™ä¼šä½¿ç”¨ submit()æ–¹æ³•å‘é€æ•°æ®

```js
// åˆ›å»ºä¸€ä¸ªformData å¯¹è±¡
const formData = new FormData()
// ç»™ formData å¯¹è±¡ è¿›è¡Œèµ‹å€¼æ“ä½œ
formData.append('key', value)
// å½“ä½ çš„è¡¨å•æ‰€æœ‰çš„å‚æ•°éƒ½éœ€è¦è¿›è¡ŒformData æ ¼å¼ ç»™åç«¯çš„æ—¶å€™
// é¡ºä¾¿å¤ä¹ ä¸€ä¸‹for in...ğŸ­
for (let key in formValue) {
  formData.append(key, formValue[key])
}
```

åé¢å°±æ˜¯è¡¨å•çš„æ ¡éªŒï¼Œç›´æ¥æäº¤å°±å¯ä»¥äº†ï¼Œå½“ç„¶ä¸è¦å¿˜è®° FormData æ ¼å¼çš„æ•°æ®éœ€è¦åœ¨æ›´æ¢è¯·æ±‚å¤´

```js
header: {
  ContentType: 'multipart/form-data' // æ ¼å¼
}
```

é‚£ä¹ˆï¼Œæˆ‘ä¸ºä»€ä¼šåœ¨è¿™é‡Œä¸º new Form()è¿™ä¸ªå®ä¾‹å¯¹è±¡ä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« å‘¢ï¼Œåœ¨å¸¸è§„çš„è¡¨å•ä¸­ï¼Œæ¶‰åŠåˆ°
æ–‡ä»¶æˆ‘ä»¬æ˜¯æ€ä¹ˆæ“ä½œçš„å‘¢ã€‚ç›¸ä¿¡å¤§å®¶å¯èƒ½ä¼šè¯´æ˜¯ç›´æ¥ä¸Šä¼  oss æœåŠ¡å™¨ï¼Œåç«¯è¿”å›è¿™ä¸ªæ–‡ä»¶çš„ idï¼Œæˆ‘
ä»¬ä¼šå°†è¿™ä¸ªæ–‡ä»¶çš„ id å¸¦ç€è¡¨å•å…¶ä»–æ•°æ®æäº¤å¯¹å§ã€‚ä½†æ˜¯è¿™ä¸ªæ—¶å€™ï¼Œå°±æ˜¯éœ€è¦ä¸€ä¸ªäºŒè¿›åˆ¶çš„æ–‡ä»¶ï¼Œå°±
æ˜¯ä¸èƒ½ç»™ä½  idï¼Œé‚£å°±åªèƒ½äº¤ç»™å‰ç«¯æ¥å¤„ç†æˆäºŒè¿›åˆ¶ï¼Œåˆ©ç”¨ formData æ ¼å¼çš„æ•°æ®æäº¤ç»™åç«¯äº†ã€‚

é‚£ä¹ˆï¼Œåœ¨å‰ç«¯å¤„ç†æ–‡ä»¶çš„æ—¶å€™ï¼Œæ€ä¹ˆå°†æ–‡ä»¶è½¬æ¢æˆäºŒè¿›åˆ¶å‘¢ï¼Œç›´æ¥ä¸Šä»£ç 

### 1. æ–‡ä»¶å¤„ç†

```js
// è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥ElementPlus çš„ä¸Šä¼ ç»„ä»¶ä¸ºä¾‹
// upload ä¸Šä¼ ç»„ä»¶çš„ å±æ€§çš„ ä¼š v-model ç»‘å®šä¸€ä¸ªæ•°ç»„æ ¼å¼æ¥å­˜æ”¾æ–‡ä»¶

const uoloadFileList = ref([]) // åŒå‘ç»‘å®šçš„æ•°ç»„

// uploadæœ‰ä¸€ä¸ªonChange å±æ€§ï¼Œå½“æ–‡ä»¶æ•°ç»„å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è§¦å‘ã€‚æˆ‘ä»¬å°±åœ¨è¿™é‡Œå¤„ç†è¿™ä¸ªæ–‡ä»¶

const handleChange = (uploadFile:UploadFile) => {
    // è¿™é‡Œå¯ä»¥åˆ¤è¯»æ–‡ä»¶çš„å¤§å° ä»¥2Må¤§å°ä¸ºä¾‹
    if(uploadFile?.size! > 1024 * 1024 * 2){
        // æç¤ºä¸€ä¸‹
    } else {
        // è¿™é‡Œå…ˆä¸åšå¤„ç†ï¼Œå› ä¸ºæœ‰æ—¶å€™ä¸æ­¢ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶å¯¹å§ï¼Œå…ˆç»™ä»–æ”¾è¿›è¿™ä¸ªæ•°ç»„é‡Œ
        // æäº¤è¡¨å•çš„æ—¶å€™ç»Ÿä¸€åšå¤„ç†
        // æ³¨æ„è¿™é‡Œæ˜¯rowè¿™ä¸ªå­—æ®µ
       uoloadFileList.value.push(uploadFile.row)
    }
}
// æäº¤è¡¨å•å¯¹æ–‡ä»¶åšå¤„ç†
const submitForm = () => {
    // åˆ›å»º forData å®ä¾‹
    const formData = new FormData()
    // è¯´æ˜ä¸Šä¼ äº†æ–‡ä»¶ï¼Œåšä¸ªå°å°çš„éç©ºæ ¡éªŒ
    // è¿˜è¦è¯´æ˜ä¸€ç‚¹æ˜¯ï¼Œè¿™é‡Œ ç©ºæ•°ç»„ æ˜¯ true æ‰€ä»¥è¦ ç”¨length æ¥åšæ ¡éªŒ
    //  Boolean([]) === true
    if(uploadFileList.value.length !== 0) {
        var blobData = new Blob([JSON.stringify(item)], { type: 'application/json' })
        var file = new File([blobData], item.name)

        // å¡è¿›formData é‡Œï¼Œä½ çš„ æ–‡ä»¶å°±è¢«è½¬æˆäºŒè¿›åˆ¶
        formData.append('file', file)
    }
}
```

### 2. å›¾ç‰‡å¤„ç†

æŠŠå›¾ç‰‡è½¬æ¢æˆäºŒè¿›åˆ¶å¡è¿› formDat å’Œæ–‡ä»¶æ²¡ä»€ä¹ˆä¸¤æ ·

```js
// å½“ç„¶ä½ ä¹Ÿå¯ä»¥åšä¸€äº›å¤§å°çš„æ ¡éªŒç­‰ç­‰ï¼Œè¿™é‡Œæœ‰æ¼”ç¤ºæ€ä¹ˆè½¬äºŒè¿›åˆ¶å°±å¥½äº†
const applicationForm = new FormData()
imageLocal.value = URL.createObjectURL(uploadFile?.raw!)
applicationForm.append('file1', uploadFile?.raw!)
img.value = uploadFile
```

ä»¥ä¸Šå°±æ˜¯åœ¨è¡¨å•ä¸­å¸¸è§ï¼Œä¸”åˆä¸æ€ä¹ˆå¸¸è§çš„ new FormData()çš„ä½¿ç”¨äº†ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿéå¸¸æ„Ÿè°¢ä½ çš„è§‚çœ‹
å¦‚æœè§‰å¾—å“ªé‡Œæœ‰é—®é¢˜ï¼Œæ¬¢è¿æ›´æ­£ã€‚
